<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Привет, меня зовут Андрей Двояк. Я специалист по комплексной разработке веб-приложений в украинском стартапе</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> </span><a href="http://preply.com/"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; text-decoration: underline; color:#9c30b6; vertical-align:top;">Preply.com</span></a><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;">, это платформа для поиска репетиторов. За последний год наша команда выросла, и для облегчения процесса адаптации новых разработчиков мы решили организовать и стандартизировать наш процесс разработки.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Мы посвятили много времени поиску лучших методик и обсуждению с другими командами, стремясь выяснить, какой путь наиболее эффективен для организации процесса разработки и распределения доступа, особенно когда ваш продукт разделен на несколько микросервисов. В итоге мы остановились на двух основных технологиях:</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> </span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-weight:600; color:#0d0d0d; vertical-align:top;">Vagrant</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> и </span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-weight:600; color:#0d0d0d; vertical-align:top;">Docker</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;">. Вы можете прочитать обо всех аспектах и особенностях у самих создателей этих сервисов </span><a href="http://stackoverflow.com/questions/16647069/should-i-use-vagrant-or-docker-for-creating-an-isolated-environment"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; text-decoration: underline; color:#9c30b6; vertical-align:top;">на StackOverflow</span></a><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;">.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">В этом руководстве я покажу вам, как «докеризировать» ваше приложение, чтобы вы таким образом могли удобно и просто распространить и развернуть его на любой машине, поддерживающей Docker.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.35%; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:x-large; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Прежде, чем начать</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">В этом руководстве мы будем работать с простым приложением Django с базой</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> </span><a href="http://www.postgresql.org/"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; text-decoration: underline; color:#9c30b6; vertical-align:top;">PostgerSQL</span></a><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> и </span><a href="http://redis.io/"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; text-decoration: underline; color:#9c30b6; vertical-align:top;">Redis</span></a><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> в качестве брокера для выполнения задач </span><a href="http://docs.celeryproject.org/en/latest/django/first-steps-with-django.html"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; text-decoration: underline; color:#9c30b6; vertical-align:top;">Celery</span></a><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;">. Также мы используем </span><a href="https://github.com/rfk/django-supervisor"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; text-decoration: underline; color:#9c30b6; vertical-align:top;">Supervisor</span></a><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> для запуска нашего сервера </span><a href="https://docs.djangoproject.com/en/1.8/howto/deployment/wsgi/gunicorn/"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; text-decoration: underline; color:#9c30b6; vertical-align:top;">Gunicorn</span></a><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;">. Мы будем использовать технологию </span><a href="http://docs.docker.com/compose/"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; text-decoration: underline; color:#9c30b6; vertical-align:top;">Docker Compose</span></a><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;">, чтобы организовать работу нашего мультиконтейнерного приложения. Обратите внимание, что Compose 1.5.1 требует Docker 1.8.0 или более поздние версии.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Это поможет нам запустить приложение Django, PostgreSQL и Redis Server и Celery Worker в отдельных контейнерах и связать их между собой. Чтобы реализовать это все, нам нужно всего лишь создать несколько файлов в корневом каталоге вашего проекта Django рядом с файлом</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> </span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">manage.py</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;">):</span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;" style=" margin-top:0px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:15px;">Dockerfile — для создания финального образа и загрузки его в DockerHub;</span></li>
<li style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;" style=" margin-top:0px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:15px;">redeploy.sh — для развертывание в обеих средах DEV и PROD;</span></li>
<li style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;" style=" margin-top:0px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:15px;">docker-compose.yml — организовать работу нескольких контейнеров;</span></li>
<li style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;" style=" margin-top:0px; margin-bottom:6px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-size:15px;">Vagrantfile — предоставить виртуальную машину для среды разработки.</span></li></ol>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Мы используем переменную RUN_ENV для определения текущей среды. Вы набираете на клавиатуре export RUN_ENV=PROD на рабочем сервере и export RUN_ENV=DEV на виртуальной машине Vagrant.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.35%; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:x-large; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Docker</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Как вы, возможно, уже знаете, о Docker нужно знать две вещи: образы и контейнеры. Мы создадим образ, основанный на Ubuntu с установленными Python, PIP и другими инструментами, необходимыми для запуска вашего приложения Django. В этом образе будет предустановлено всё, что необходимо. Этот образ направим в публичное хранилище в DockerHub. Имейте ввиду, что этот образ не содержит ни одного файла вашего проекта.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Мы договорились хранить наш образ на DockerHub всегда обновленным. С этого образа мы загрузим контейнер, пробрасывая специфические порты и монтируя ваш локальный каталог с проектом к какой-то папке внутри контейнера. Это означает, что файлы вашего проекта будут доступны внутри контейнера. Никакой необходимости копировать файлы! Это очень удобно для процесса разработки, потому что вы можете вносить изменения в ваши файлы, и они сразу же будут изменены в работающем контейнере Docker, но это неприемлемо в реальной рабочей среде.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Как только вы запустили контейнер, мы запустим Supervisor с вашим сервером Gunicorn. Как только вы захотели сделать повторное развертывание, мы извлечем новые данные из GitHub, остановим и удалим существующий контейнер и запустим совершенно новый контейнер. Настоящее волшебство!</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.35%; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:x-large; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Установка Docker и Docker-Compose</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Прежде чем начать, нам нужно установить Docker и Docker-Compose на наш локальный компьютер или сервер. Ниже указан скрипт, который это делает на Ubuntu 14.04:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">sudo -i</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">echo 'debconf debconf/frontend select Noninteractive' | debconf-set-selections</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">curl -sSL https://get.docker.com/ | sh</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">curl -L https://github.com/docker/compose/releases/download/1.5.1/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">chmod +x /usr/local/bin/docker-compose</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">usermod -aG docker ubuntu</span></p>
<p style=" margin-top:0px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">sudo reboot</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Тут</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> </span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">ubuntu</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> — ваш текущий пользователь.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Если ваша текущая среда разработки не Ubuntu 14.04 — тогда вам будет лучше использовать Vagrant для создания этой среды. Подробнее расскажу в следующей статье.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.35%; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:x-large; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Образ Docker</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Во-первых, для подготовки проекта к развертыванию докером нам нужно создать образ при помощи только Python, PIP и нескольких зависимостей, необходимых для запуска Django.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Давайте создадим новый докер файл под названием Dockerfile в корневом каталоге проекта. Это будет выглядеть так:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">FROM ubuntu:14.04</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">MAINTAINER Andrii Dvoiak</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">RUN echo 'debconf debconf/frontend select Noninteractive' | debconf-set-selections</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">RUN apt-get update</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">RUN apt-get install -y python-pip python-dev python-lxml libxml2-dev libxslt1-dev libxslt-dev libpq-dev zlib1g-dev &amp;&amp; apt-get build-dep -y python-lxml &amp;&amp; apt-get clean</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;"># Specify your own RUN commands here (e.g. RUN apt-get install -y nano)</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">ADD requirements.txt requirements.txt</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">RUN pip install -r requirements.txt</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">WORKDIR /project</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;"><br /></p>
<p style=" margin-top:0px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">EXPOSE 80</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Вы можете указать ваши собственные команды RUN, например, установить другие необходимые инструменты.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Затем вам нужно создать образ из этого, используя команду:</span></p>
<p style=" margin-top:0px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">docker build -t username/image</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Тут</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> </span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">username</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> — ваше имя пользователя Dockerhub и image — название вашего нового образа для данного проекта.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Когда вам успешно удалось создать основной образ, лучше будет вам загрузить в облако DockerHub. Это можно сделать командой</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> </span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">docker push username/image</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;">. И не переживайте, в этом образе нет никакой информации из вашего проекта (кроме файла </span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">requiremets.txt</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;">). Если вы используете приватное хранилище DockerHub, удостоверьтесь в исполнении </span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">docker login</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> перед загрузкой/выгрузкой образов.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.35%; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:x-large; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Организация работы контейнеров</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Итак, на данном этапе мы можем запустить наш контейнер с приложениям Django, но нам также нужно запустить некоторые другие контейнеры c Redis, базой данных PostgreSQL и Celery Worker. Чтобы упростить этот процесс, мы воспользуемся технологией</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> </span><a href="http://docs.docker.com/compose/"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; text-decoration: underline; color:#9c30b6; vertical-align:top;">Docker Compose</span></a><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;">, которая позволяет нам создать простой файл YML с инструкциями о том, какие контейнеры запускать и как линковать их между собой.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Давайте создадим этот волшебный файл и назовем его по умолчанию docker-compose</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;">.yml:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">django:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">  image: username/image:latest</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">  command: python manage.py supervisor</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">  environment:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">    RUN_ENV: &quot;$RUN_ENV&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">  ports:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">   - &quot;80:8001&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">  volumes:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">   - .:/project</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">  links:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">   - redis</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">   - postgres</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">celery_worker:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">  image: username/image:latest</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">  command: python manage.py celery worker -l info</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">  links:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">   - postgres</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">   - redis</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">postgres:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">  image: postgres:9.1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">  volumes:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">    - local_postgres:/var/lib/postgresql/data</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">  ports:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">   - &quot;5432:5432&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">  environment:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">    POSTGRES_PASSWORD: &quot;$POSTGRES_PASSWORD&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">    POSTGRES_USER: &quot;$POSTGRES_USER&quot;  </span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">redis:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">  image: redis:latest</span></p>
<p style=" margin-top:0px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">  command: redis-server --appendonly yes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Как вы видите, мы запустим четыре проекта под названиями</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> </span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">django</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;">, </span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">celery_worker</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;">, </span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">postgres</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> и </span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">redis</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;">. Эти названия важны для нас.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Итак, во-первых, наш файл загрузит образ Redis из dockerhub и запустит из него контейнер. Во-вторых, он загрузит образ Postgres и запустит контейнер с закрепленными данными из радела local_postgres. О создании локальной базы данных расскажу подробней в следющей статье.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Затем, этот файл запустит контейнер с нашим приложением Django, направит</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> 8001-й порт изнутри на 80-й снаружи, свяжет ваш текущий каталог прямо с папкой /project внутри контейнера, пролинкует его с контейнерами Redis и Postgres и запустит супервайзера. И последнее, но не менее важное — наш контейнер с celery worker, который также пролинкован с Postgres и Redis.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Вы можете направить любое количество портов, если необходимо — для этого просто добавьте новые записи в соответствующий раздел. Также вы можете пролинковать любое количество контейнеров, например, контейнер с вашей базой данных. Используйте тег</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> </span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">:latest</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> для автоматической проверки обновленного образа на DockerHub.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Если вы назвали проект Redis Server именем</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> </span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">redis</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> в файле YML — вам нужно указать </span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">redis</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> вместо </span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">localhost</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> в вашем </span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">settings.py</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> чтобы позволить вашему приложению Django подсоединиться к </span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">redis</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">REDIS_HOST = &quot;redis&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">BROKER_URL = &quot;redis&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">То же с базой данных Postgres — используйте</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> </span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">postgres</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> вместо </span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">localhost</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">DATABASES = {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">    'default': {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">        'ENGINE': 'django.db.backends.postgresql_psycopg2',</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">        'NAME': 'database_name',</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">        'USER': os.getenv('DATABASE_USER', ''),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">        'PASSWORD': os.getenv('DATABASE_PASSWORD', ''),</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">        'HOST': 'postgres',</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">        'PORT': '5432',</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">    }</span></p>
<p style=" margin-top:0px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">}</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.35%; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:x-large; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Скрипт для повторного развертывания</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Давайте создадим скрипт для повторного развертывания в один клик (давайте назовем его redeploy</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;">.sh):</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">#!/bin/sh</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">if [ -z &quot;$RUN_ENV&quot; ]; then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">    echo 'Please set up RUN_ENV variable'</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">    exit 1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">fi</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">if [ &quot;$RUN_ENV&quot; = &quot;PROD&quot; ]; then</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">    git pull</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">fi</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">docker-compose stop</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">docker-compose rm -f</span></p>
<p style=" margin-top:0px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">docker-compose up -d</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Давайте проверим, что он делает:</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"><br />— Он проверяет, установлена ли переменная RUN_ENV и совершает выход, если нет<br />Если RUN_ENV установлена на PROD, он сделает команду ’git pull’ чтобы получить новую версию вашего проекта;<br />— Он остановит все проекты, указанные в файле docker-compose.yml;<br />— Он удалит все существующие контейнеры;<br />— Он запустит новые контейнеры.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Итак, это выглядит достаточно просто: чтобы сделать повторное развертывание, вам нужно всего лишь запустить</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> </span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">./redeploy.sh</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;">. Не забудьте дать права на исполнение (</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">chmod +x redeploy.sh</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;">) этому скрипту и всем другим скриптам, описанным в инструкции.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Чтобы сделать быстрое повторное развертывание, используйте эту команду:</span></p>
<p style=" margin-top:0px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">docker-compose up --no-deps -d django</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.35%; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:x-large; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Развертывание внутри контейнера</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Нам нужно всего лишь запустить супервайзера для того, чтобы собственно запустить наш сервис внутри контейнера:</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> </span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">python manage.py supervisor</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;">. Если вы не используете супервайзер, вы можете просто запустить ваш сервер вместо супервайзера.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Если же вы пользуетесь супервайзером, давайте посмотрим на файл ’supervisord.conf’:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">[supervisord]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">environment=C_FORCE_ROOT=&quot;1&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">[program:__defaults__]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">redirect_stderr=true</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">startsecs=10</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">autorestart=true</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">[program:gunicorn_server]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">command=gunicorn -w 4 -b 0.0.0.0:8001 YourApp.wsgi:application</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">directory={{ PROJECT_DIR }}</span></p>
<p style=" margin-top:0px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">stdout_logfile={{ PROJECT_DIR }}/gunicorn.log</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Итак, супервайзер запустит ваш сервер Gunicorn с 4 работающими процессами и связанным портом 8001.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.35%; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:x-large; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Процесс разработки</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Чтобы зайти на ваш локальный сервер, пройдите по </span><a href="http://127.0.0.1:8000/"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; text-decoration: underline; color:#9c30b6; vertical-align:top;">127.0.0.1:8000</span></a><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;">.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Для повторного развертывания локальных изменений сделайте:</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"><br /></span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">sh redeploy.sh</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Чтобы просмотреть все логи в вашем проекте, выполните:</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"><br /></span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">docker-compose logs</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Чтобы быстро реализовать повторное развертывание изменений, используйте:</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"><br /></span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">docker-compose restart django</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Чтобы подсоединиться к Django — просто подсоединяйтесь (если ваш работающий контейнер назван CONTAINER):</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> <br /></span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">docker exec -it CONTAINER python manage.py shell</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Чтобы создать изначального суперпользователя:</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"><br /></span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">from django.contrib.auth.models import User; User.objects.create_superuser(’admin’, </span><a href="mailto:'admin@example.com"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; text-decoration: underline; color:#9c30b6; vertical-align:top;">’admin@example.com</span></a><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">’, ’admin’)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Выполнить миграцию:</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"><br /></span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">docker exec -it CONTAINER python manage.py schemamigration blabla —auto</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Или вы можете подсоединиться к bash внутри контейнера:</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"><br /></span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">docker exec -it CONTAINER /bin/bash</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Вы можете сохранить вашу локальную базу данных в файл .json (вы можете указать таблицу для сохранения):</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"><br /></span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">docker exec -it CONTAINER python </span><a href="http://manage.py/"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; text-decoration: underline; color:#9c30b6; vertical-align:top;">manage.py</span></a><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;"> dumpdata &gt; testdb.json</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Или вы можете загрузить данные в вашу базу данных из файла:</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"><br /></span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">docker exec -it CONTAINER python </span><a href="http://manage.py/"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; text-decoration: underline; color:#9c30b6; vertical-align:top;">manage.py</span></a><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;"> loaddata testdb.json</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Используйте эту команду для мониторинга статуса ваших работающих контейнеров:</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"><br /></span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">docker stats $(docker ps -q)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Используйте эту команду для удаления всех остановленных контейнеров:</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"><br /></span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">docker rm -v `docker ps -a -q -f status=exited`</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Вы можете играться с вашими контейнерами как вам захочется. Здесь — полезный</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> </span><a href="https://github.com/wsargent/docker-cheat-sheet"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; text-decoration: underline; color:#9c30b6; vertical-align:top;">Docker cheat sheet</span></a><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;">.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.35%; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:x-large; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">GIT</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Когда сервер работает, он будет создавать дополнительные файлы, такие как</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> </span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">.log</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;">, </span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">.pid</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> и так далее. Вам не нужно их включать в репозиторий. Не забудьте создать файл </span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">.gitignore</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">.idea</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">db.sqlide3</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">*.pyc</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">*.ini</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">*.log</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">*.pid</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">/static</span></p>
<p style=" margin-top:0px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">.vagrant/</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:1.35%; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:x-large; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Статические файлы</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">У вас могут обнаружиться некоторые проблемы в работе со статическими файлами на рабочем сервере при использовании только gunicorn, поэтому не забудьте создать пустую папку</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> </span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">/static/</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> в вашем корневом каталоге проекта с файлом </span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">__init__.py</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> для обслуживания из него статики.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">По этой схеме ваш файл</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> settings.py должен включать:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">STATIC_URL = '/static/'</span></p>
<p style=" margin-top:0px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">STATIC_ROOT = os.path.join(BASE_DIR, 'static')</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">И для обслуживания статики с помощью gunicorn на рабочем сервере добавьте это в конец файла</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> </span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-style:italic; color:#0d0d0d; vertical-align:top;">urls.py</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;">:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">SERVER_ENVIRONMENT = os.getenv('RUN_ENV', '')</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">if SERVER_ENVIRONMENT == 'PROD':</span></p>
<p style=" margin-top:0px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#f0f0f0;"><span style=" font-family:'Courier New,courier'; font-size:12px; color:#303030; background-color:#f0f0f0;">    urlpatterns += patterns('', (r'^static/(?P&lt;path&gt;.*)$', 'django.views.static.serve', {'document_root': settings.STATIC_ROOT}), )</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; background-color:#ffffff; vertical-align:top;">Или же вы можете пользоваться другими сервисами для обслуживания статических файлов, например, использовать сервер nGinx.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"><br /></span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; font-weight:600; color:#0d0d0d; vertical-align:top;">P.S.</span><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> </span><a href="http://dou.ua/lenta/articles/vagrant"><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; text-decoration: underline; color:#9c30b6; vertical-align:top;">В следующей статье</span></a><span style=" font-family:'Pt Sans,Arial,sans-serif'; font-size:15px; color:#0d0d0d; vertical-align:top;"> я расскажу, как запустить Docker практически где угодно при помощи Vagrant. Также рассмотрим, как создавать среду разработки на виртуальной машине, которую вы можете легко передать вашим сотрудникам, не беспокоясь о том, какие операционные системы установлены у них локально.</span></p></body></html>