<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:0px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Arial,Helvetica Neue,Helvetica,sans-serif'; font-size:15px; color:#242729; background-color:#ffffff;">On my Linux desktop I have a UTF-8 locale. When I try to search some KOI8-R encoded files with grep (ack), it fails. If I manually encode the pattern into KOI8-R and pass that as an argument, it works.</span></p>
<p style=" margin-top:0px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Arial,Helvetica Neue,Helvetica,sans-serif'; font-size:15px; color:#242729; background-color:#ffffff;">Is it possible to tell grep what encoding to use for the pattern? Or any other tool?</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Arial,Helvetica Neue,Helvetica,sans-serif'; font-size:15px; color:#242729; background-color:#ffffff;"><br /></p>
<p style=" margin-top:0px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Arial,Helvetica Neue,Helvetica,sans-serif'; font-size:15px; color:#242729; background-color:#ffffff;">If all the files you're searching in have the same encoding:</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,sans-serif'; font-size:13px; color:#242729; background-color:#eff0f1;">LC_CTYPE=ru_RU.KOI8-R luit ack-grep &quot;$(echo 'привет' | iconv -t KOI8-R)&quot; *.txt</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,sans-serif'; font-size:13px; color:#242729; background-color:#eff0f1;"><br /></pre>
<p style=" margin-top:0px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Arial,Helvetica Neue,Helvetica,sans-serif'; font-size:15px; color:#242729; background-color:#ffffff;">or in bash or zsh</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,sans-serif'; font-size:13px; color:#242729; background-color:#eff0f1;">LC_CTYPE=ru_RU.KOI8-R luit ack-grep &quot;$(iconv -t KOI8-R &lt;&lt;&lt;'привет')&quot; *.txt</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,sans-serif'; font-size:13px; color:#242729; background-color:#eff0f1;"><br /></pre>
<p style=" margin-top:0px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Arial,Helvetica Neue,Helvetica,sans-serif'; font-size:15px; color:#242729; background-color:#ffffff;">Or start a child shell in the desired encoding:</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,sans-serif'; font-size:13px; color:#242729; background-color:#eff0f1;">$ LC_CTYPE=ru_RU.KOI8-R luit</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,sans-serif'; font-size:13px; color:#242729; background-color:#eff0f1;">$ ack-grep 'привет' *.txt</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,sans-serif'; font-size:13px; color:#242729; background-color:#eff0f1;">$ exit</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,sans-serif'; font-size:13px; color:#242729; background-color:#eff0f1;"><br /></pre>
<p style=" margin-top:0px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a href="http://www.pps.jussieu.fr/~jch/software/luit/"><span style=" font-family:'Arial,Helvetica Neue,Helvetica,sans-serif'; font-size:15px; color:#1078a5;">Luit</span></a><span style=" font-family:'Arial,Helvetica Neue,Helvetica,sans-serif'; font-size:15px; color:#242729;"> (shipped with XFree86 and X.org) runs the program specified on its command line in the locale specified by the </span><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,sans-serif'; font-size:13px; color:#242729; background-color:#eff0f1;">LC_CTYPE</span><span style=" font-family:'Arial,Helvetica Neue,Helvetica,sans-serif'; font-size:15px; color:#242729;"> setting, assuming an UTF-8 terminal. So the command runs in the desired locale, and Luit translates its terminal output to UTF-8.</span></p>
<p style=" margin-top:0px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Arial,Helvetica Neue,Helvetica,sans-serif'; font-size:15px; color:#242729; background-color:#ffffff;">Another approach, if you have a directory tree with a lot of files in a different encoding, is to mount a view of that directory tree under a your prefered encoding. I think the</span><span style=" font-family:'Arial,Helvetica Neue,Helvetica,sans-serif'; font-size:15px; color:#242729;"> </span><a href="http://users.softlab.ntua.gr/~thkala/projects/fuseflt/fuseflt.html"><span style=" font-family:'Arial,Helvetica Neue,Helvetica,sans-serif'; font-size:15px; color:#1078a5;">fuseflt</span></a><span style=" font-family:'Arial,Helvetica Neue,Helvetica,sans-serif'; font-size:15px; color:#242729;"> filesystem can do this (untested).</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,sans-serif'; font-size:13px; color:#242729; background-color:#eff0f1;">mkdir /utf8-view</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,sans-serif'; font-size:13px; color:#242729; background-color:#eff0f1;">fuseflt iconv-koi8r-utf8.conf /some/dir /utf8-view</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,sans-serif'; font-size:13px; color:#242729; background-color:#eff0f1;">ack-grep 'привет' /utf8-view/*.txt.utf8</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,sans-serif'; font-size:13px; color:#242729; background-color:#eff0f1;">fusermount -u /utf8-view</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,sans-serif'; font-size:13px; color:#242729; background-color:#eff0f1;"><br /></pre>
<p style=" margin-top:0px; margin-bottom:17px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Arial,Helvetica Neue,Helvetica,sans-serif'; font-size:15px; color:#242729; background-color:#ffffff;">where the configuration file</span><span style=" font-family:'Arial,Helvetica Neue,Helvetica,sans-serif'; font-size:15px; color:#242729;"> </span><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,sans-serif'; font-size:13px; color:#242729; background-color:#eff0f1;">iconv-koi8r-utf8.conf</span><span style=" font-family:'Arial,Helvetica Neue,Helvetica,sans-serif'; font-size:15px; color:#242729;"> contains</span></p>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,sans-serif'; font-size:13px; color:#242729; background-color:#eff0f1;">ext_in =</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,sans-serif'; font-size:13px; color:#242729; background-color:#eff0f1;">ext_out = *.utf8</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,sans-serif'; font-size:13px; color:#242729; background-color:#eff0f1;">flt_in =</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,sans-serif'; font-size:13px; color:#242729; background-color:#eff0f1;">flt_out = .utf8</span></pre>
<pre style=" margin-top:0px; margin-bottom:15px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#eff0f1;"><span style=" font-family:'Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,sans-serif'; font-size:13px; color:#242729; background-color:#eff0f1;">flt_cmd = iconv -f KOI8-R -t UTF-8</span></pre></body></html>