<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:20px; color:#212529; background-color:#ffffff;">Openresty, большой набор модулей для Nginx'a, открывает много возможностей для разработки прямо на популярном Web сервере. Одним из главных достоинств этого пакета является расширение для поддержки языка Lua в Nginx.</span></p>
<p style=" margin-top:40px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:60px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:x-large; color:#212529; background-color:#ffffff;">Установка</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:20px; color:#212529; background-color:#ffffff;">В Debian системах все, что нужно, есть в пакете:</span></p>
<pre style=" margin-top:20px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa; background-color:#212529;">apt-get install nginx-extras</span></pre>
<p style=" margin-top:40px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:60px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:x-large; color:#212529; background-color:#ffffff;">Hello world</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:20px; color:#212529; background-color:#ffffff;">Выведем</span><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:20px; color:#212529;"> </span><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; font-weight:600; color:#212529; background-color:#eeeeee;">hello world</span><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:20px; color:#212529;">:</span></p>
<pre style=" margin-top:20px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">server {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">  location /hello {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">    default_type 'text/plain';</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa; background-color:#212529;"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">    content_by_lua '</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">        ngx.say(&quot;Hello world!&quot;)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">    ';</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">  }</span></pre>
<pre style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">}</span></pre>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#888888; background-color:#ffffff;"># Выведем известную строку прямо с помощью Nginx'a</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:20px; color:#212529; background-color:#ffffff;">Теперь</span><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:20px; color:#212529;"> </span><a href="https://ruhighload.com/post/%D0%9A%D0%B0%D0%BA+%D0%BF%D0%B5%D1%80%D0%B5%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D1%82%D0%B8%D1%82%D1%8C+nginx"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:20px; text-decoration: underline; color:#e85f63;">перезапустим Nginx</span></a><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:20px; color:#212529;">:</span></p>
<pre style=" margin-top:20px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa; background-color:#212529;">nginx -s reload</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:20px; color:#212529; background-color:#ffffff;">И по адресу</span><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:20px; color:#212529;"> </span><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; font-weight:600; color:#212529; background-color:#eeeeee;">http://сайт/hello</span><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:20px; color:#212529;"> увидим:</span></p>
<pre style=" margin-top:20px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa; background-color:#212529;">Hello world!</span></pre>
<p style=" margin-top:40px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:60px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:x-large; color:#212529; background-color:#ffffff;">Вывод HTML</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:20px; color:#212529; background-color:#ffffff;">Чтобы вывести HTML достаточно заменить тип контента и указать сам контент:</span></p>
<pre style=" margin-top:20px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">server {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">  location /hello {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">    default_type </span><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; font-weight:600; color:#adff2f;">'text/html'</span><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">;</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa; background-color:#212529;"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">    content_by_lua '</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">        ngx.say(&quot;</span><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; font-weight:600; color:#adff2f;">Hello &lt;b&gt;world&lt;/b&gt;!</span><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">&quot;)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">    ';</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">  }</span></pre>
<pre style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">}</span></pre>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#888888; background-color:#ffffff;"># Выводим HTML из Nginx Lua</span></p>
<p style=" margin-top:40px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:60px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:x-large; color:#212529; background-color:#ffffff;">Организация кода</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:20px; color:#212529; background-color:#ffffff;">Для удобства стоит использовать внешние Lua файлы:</span></p>
<pre style=" margin-top:20px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">server {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">  location / {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">    default_type 'text/plain';</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">    </span><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; font-weight:600; color:#adff2f;">content_by_lua_file /var/www/lua/index.lua</span><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">;</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa; background-color:#212529;"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">    # Отключим кэширование кода для разработки</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">    # (это нужно закомментировать, когда выкатим на продакшн)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">    lua_code_cache off;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">  }</span></pre>
<pre style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">}</span></pre>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#888888; background-color:#ffffff;"># загрузка Lua кода из внешних файлов</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:20px; color:#212529; background-color:#ffffff;">Во время разработки удобно использовать</span><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:20px; color:#212529;"> </span><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; font-weight:600; color:#212529; background-color:#eeeeee;">lua_code_cache</span><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:20px; color:#212529;">, т.к. код файла можно будет менять без перезапуска Nginx'a.</span></p>
<p style=" margin-top:40px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:51px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:large; color:#333333; background-color:#ffffff;">Несколько обработчиков</span></p>
<pre style=" margin-top:20px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">server {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">  </span><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; font-weight:600; color:#adff2f;">location /</span><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;"> {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">    default_type 'text/plain';</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">    content_by_lua_file /var/www/lua/index.lua;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">  }</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa; background-color:#212529;"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">  </span><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; font-weight:600; color:#adff2f;">location /admin</span><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;"> {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">    default_type 'text/plain';</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">    content_by_lua_file /var/www/lua/admin.lua;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">  }</span></pre>
<pre style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">}</span></pre>
<p style=" margin-top:40px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:60px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:x-large; color:#212529; background-color:#ffffff;">Глобальные переменные</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:20px; color:#212529; background-color:#ffffff;">Для настроек и статистики удобно использовать глобальные переменные (они будут иметь одинаковые значения для всех запросов):</span></p>
<pre style=" margin-top:20px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">http {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">    # объявляем глобальный контейнер</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">    </span><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; font-weight:600; color:#adff2f;">lua_shared_dict stats 1m</span><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">;</span></pre>
<pre style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa; background-color:#212529;"><br /></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">    server {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">        location / {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">            content_by_lua '</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">		# увеличим переменную hits на 1 при каждом запросе</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">                </span><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; font-weight:600; color:#adff2f;">ngx.shared.stats:incr(&quot;hits&quot;, 1)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">		</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">		# выведем текущее значение</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">                ngx.say(ngx.shared.stats:get(&quot;hits&quot;))</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">            ';</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">        }</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">    }</span></pre>
<pre style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">}</span></pre>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#888888; background-color:#ffffff;"># Используем глобальную переменную для подсчета количества запросов</span></p>
<p style=" margin-top:40px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:60px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:x-large; color:#212529; background-color:#ffffff;">Работа с данными</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:20px; color:#212529; background-color:#ffffff;">Nginx поддерживает работу с разными базами данных, в т.ч. Mysql и Redis.</span></p>
<pre style=" margin-top:20px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa; background-color:#212529;">apt-get install lua-nginx-redis</span></pre>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:20px; color:#212529; background-color:#ffffff;">Пример простого скрипта для подсчета количества запросов в Redis'e:</span></p>
<pre style=" margin-top:20px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">server {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">        location / {</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">            content_by_lua '</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">		local redis = require &quot;nginx.redis&quot;</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">		local red = redis:new()</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">		local ok, err = red:connect(&quot;127.0.0.1&quot;, 6379)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">		ok, err = red:incr(&quot;test&quot;)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">		local res, err = red:get(&quot;test&quot;)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">		ngx.say(&quot;hits: &quot;, res)</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">            ';</span></pre>
<pre style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">        }</span></pre>
<pre style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#aaaaaa;">}</span></pre>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:12px; color:#888888; background-color:#ffffff;"># Увеличиваем счетчик test с помощью Redis</span></p>
<p style=" margin-top:40px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:60px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:x-large; color:#212529; background-color:#ffffff;">Самое главное</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><a href="http://openresty.org/"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:20px; text-decoration: underline; color:#e85f63;">Openresty</span></a><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:20px; color:#212529;"> позволяет использовать Nginx не просто как Web сервер, а как полноценную платформу. С помощью Lua можно реализовать большой набор функционала, в т.ч. и работу с данными.</span></p></body></html>