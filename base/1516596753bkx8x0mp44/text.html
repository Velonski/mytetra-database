<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="prerequisites"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">P</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">rerequisites</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://docs.docker.com/engine/installation/"><span style=" text-decoration: underline; color:#0000ff;">Install Docker version 1.13 or higher</span></a>. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Get <a href="https://docs.docker.com/compose/overview/"><span style=" text-decoration: underline; color:#0000ff;">Docker Compose</span></a>. On <a href="https://docs.docker.com/docker-for-mac/"><span style=" text-decoration: underline; color:#0000ff;">Docker for Mac</span></a> and <a href="https://docs.docker.com/docker-for-windows/"><span style=" text-decoration: underline; color:#0000ff;">Docker for Windows</span></a> it’s pre-installed, so you’re good-to-go. On Linux systems you will need to <a href="https://github.com/docker/compose/releases"><span style=" text-decoration: underline; color:#0000ff;">install it directly</span></a>. On pre Windows 10 systems <span style=" font-style:italic;">without Hyper-V</span>, use <a href="https://docs.docker.com/toolbox/overview/"><span style=" text-decoration: underline; color:#0000ff;">Docker Toolbox</span></a>. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Read the orientation in <a href="https://docs.docker.com/get-started/"><span style=" text-decoration: underline; color:#0000ff;">Part 1</span></a>. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Learn how to create containers in <a href="https://docs.docker.com/get-started/part2/"><span style=" text-decoration: underline; color:#0000ff;">Part 2</span></a>. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Make sure you have published the <span style=" font-family:'Courier New,courier';">friendlyhello</span> image you created by <a href="https://docs.docker.com/get-started/part2/#share-your-image"><span style=" text-decoration: underline; color:#0000ff;">pushing it to a registry</span></a>. We’ll use that shared image here. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Be sure your image works as a deployed container. Run this command, slotting in your info for <span style=" font-family:'Courier New,courier';">username</span>, <span style=" font-family:'Courier New,courier';">repo</span>, and <span style=" font-family:'Courier New,courier';">tag</span>: <span style=" font-family:'Courier New,courier';">docker run -p 80:80 username/repo:tag</span>, then visit <span style=" font-family:'Courier New,courier';">http://localhost/</span>. </li></ul>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="introduction"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">I</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">ntroduction</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">In part 3, we scale our application and enable load-balancing. To do this, we must go one level up in the hierarchy of a distributed application: the </span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">service</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Stack </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-weight:600;">Services</span> (you are here) </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Container (covered in <a href="https://docs.docker.com/get-started/part2/"><span style=" text-decoration: underline; color:#0000ff;">part 2</span></a>) </li></ul>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="about-services"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">A</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">bout services</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">In a distributed application, different pieces of the app are called “services.” For example, if you imagine a video sharing site, it probably includes a service for storing application data in a database, a service for video transcoding in the background after a user uploads something, a service for the front-end, and so on. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Services are really just “containers in production.” A service only runs one image, but it codifies the way that image runs—what ports it should use, how many replicas of the container should run so the service has the capacity it needs, and so on. Scaling a service changes the number of container instances running that piece of software, assigning more computing resources to the service in the process. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Luckily it’s very easy to define, run, and scale services with the Docker platform – just write a </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-compose.yml</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> file. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="your-first-docker-composeyml-file"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">Y</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">our first </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; font-weight:600;">docker-compose.yml</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;"> file</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">A </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-compose.yml</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> file is a YAML file that defines how Docker containers should behave in production. </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="docker-composeyml"></a><span style=" font-family:'Courier New,courier'; font-size:8.25pt; font-weight:600;">d</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; font-weight:600;">ocker-compose.yml</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Save this file as </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-compose.yml</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> wherever you want. Be sure you have </span><a href="https://docs.docker.com/get-started/part2/#share-your-image"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">pushed the image</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> you created in </span><a href="https://docs.docker.com/get-started/part2/"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">Part 2</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> to a registry, and update this </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">.yml</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> by replacing </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">username/repo:tag</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> with your image details. </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">version: &quot;3&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">services:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  web:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    # replace username/repo:tag with your name and image details</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    image: username/repo:tag</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    deploy:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">      replicas: 5</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">      resources:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">        limits:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">          cpus: &quot;0.1&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">          memory: 50M</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">      restart_policy:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">        condition: on-failure</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    ports:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">      - &quot;80:80&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    networks:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">      - webnet</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">networks:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  webnet:</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">This </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-compose.yml</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> file tells Docker to do the following: </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Pull <a href="https://docs.docker.com/get-started/part2/"><span style=" text-decoration: underline; color:#0000ff;">the image we uploaded in step 2</span></a> from the registry. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Run 5 instances of that image as a service called <span style=" font-family:'Courier New,courier';">web</span>, limiting each one to use, at most, 10% of the CPU (across all cores), and 50MB of RAM. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Immediately restart containers if one fails. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Map port 80 on the host to <span style=" font-family:'Courier New,courier';">web</span>’s port 80. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Instruct <span style=" font-family:'Courier New,courier';">web</span>’s containers to share port 80 via a load-balanced network called <span style=" font-family:'Courier New,courier';">webnet</span>. (Internally, the containers themselves will publish to <span style=" font-family:'Courier New,courier';">web</span>’s port 80 at an ephemeral port.) </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Define the <span style=" font-family:'Courier New,courier';">webnet</span> network with the default settings (which is a load-balanced overlay network). </li></ul>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="run-your-new-load-balanced-app"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">R</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">un your new load-balanced app</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Before we can use the </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker stack deploy</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> command we’ll first run: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker swarm init</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">Note</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">: We’ll get into the meaning of that command in </span><a href="https://docs.docker.com/get-started/part4/"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">part 4</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. If you don’t run </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker swarm init</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> you’ll get an error that “this node is not a swarm manager.” </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Now let’s run it. You have to give your app a name. Here, it is set to </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">getstartedlab</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker stack deploy -c docker-compose.yml getstartedlab</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Our single service stack is running 5 container instances of our deployed image on one host. Let’s investigate. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Get the service ID for the one service in our application: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker service ls</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">You’ll see output for the </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">web</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> service, prepended with your app name. If you named it the same as shown in this example, the name will be </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">getstartedlab_web</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. The service ID is listed as well, along with the number of replicas, image name, and exposed ports. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">A single container running in a service is called a </span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">task</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. Tasks are given unique IDs that numerically increment, up to the number of </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">replicas</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> you defined in </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-compose.yml</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. List the tasks for your service: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker service ps getstartedlab_web</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Tasks also show up if you just list all the containers on your system, though that will not be filtered by service: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker container ls -q</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">You can run </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">curl -4 http://localhost</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> several times in a row, or go to that URL in your browser and hit refresh a few times. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image12439.png" /><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Either way, you’ll see the container ID change, demonstrating the load-balancing; with each request, one of the 5 tasks is chosen, in a round-robin fashion, to respond. The container IDs will match your output from the previous command (</span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker container ls -q</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">). </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Running Windows 10? </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Windows 10 PowerShell should already have </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">curl</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> available, but if not you can grab a Linux terminal emulator like </span><a href="https://git-for-windows.github.io/"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">Git BASH</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">, or download </span><a href="http://gnuwin32.sourceforge.net/packages/wget.htm"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">wget for Windows</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> which is very similar. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Slow response times? </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Depending on your environment’s networking configuration, it may take up to 30 seconds for the containers to respond to HTTP requests. This is not indicative of Docker or swarm performance, but rather an unmet Redis dependency that we will address later in the tutorial. For now, the visitor counter isn’t working for the same reason; we haven’t yet added a service to persist data. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="scale-the-app"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">S</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">cale the app</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">You can scale the app by changing the </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">replicas</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> value in </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-compose.yml</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">, saving the change, and re-running the </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker stack deploy</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> command: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker stack deploy -c docker-compose.yml getstartedlab</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Docker will do an in-place update, no need to tear the stack down first or kill any containers. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Now, re-run </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker container ls -q</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> to see the deployed instances reconfigured. If you scaled up the replicas, more tasks, and hence, more containers, are started. </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="take-down-the-app-and-the-swarm"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">T</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">ake down the app and the swarm</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Take the app down with <span style=" font-family:'Courier New,courier';">docker stack rm</span>: </li>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker stack rm getstartedlab</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Take down the swarm. </li></ul>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker swarm leave --force</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">It’s as easy as that to stand up and scale your app with Docker. You’ve taken a huge step towards learning how to run containers in production. Up next, you will learn how to run this app as a bonafide swarm on a cluster of Docker machines. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">Note</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">: Compose files like this are used to define applications with Docker, and can be uploaded to cloud providers using </span><a href="https://docs.docker.com/docker-cloud/"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">Docker Cloud</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">, or on any hardware or cloud provider you choose with </span><a href="https://www.docker.com/enterprise-edition"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">Docker Enterprise Edition</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://docs.docker.com/get-started/part4/"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">On to “Part 4” »</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="recap-and-cheat-sheet-optional"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">R</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">ecap and cheat sheet (optional)</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Here’s </span><a href="https://asciinema.org/a/b5gai4rnflh7r0kie01fx6lip"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">a terminal recording of what was covered on this page</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="asciicast-container-b5gai4rnflh7r0kie01fx6lip"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">T</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">o recap, while typing </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker run</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> is simple enough, the true implementation of a container in production is running it as a service. Services codify a container’s behavior in a Compose file, and this file can be used to scale, limit, and redeploy our app. Changes to the service can be applied in place, as it runs, using the same command that launched the service: </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker stack deploy</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Some commands to explore at this stage: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker stack ls                                            # List stacks or apps</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker stack deploy -c &lt;composefile&gt; &lt;appname&gt;  # Run the specified Compose file</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker service ls                 # List running services associated with an app</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker service ps &lt;service&gt;                  # List tasks associated with an app</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker inspect &lt;task or container&gt;                   # Inspect task or container</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker container ls -q                                      # List container IDs</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker stack rm &lt;appname&gt;                             # Tear down an application</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker swarm leave --force      # Take down a single node swarm from the manager</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:8.25pt;"><br /></p></body></html>