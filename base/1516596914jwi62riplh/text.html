<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="prerequisites"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">P</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">rerequisites</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://docs.docker.com/engine/installation/"><span style=" text-decoration: underline; color:#0000ff;">Install Docker version 1.13 or higher</span></a>. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Get <a href="https://docs.docker.com/compose/overview/"><span style=" text-decoration: underline; color:#0000ff;">Docker Compose</span></a> as described in <a href="https://docs.docker.com/get-started/part3/#prerequisites"><span style=" text-decoration: underline; color:#0000ff;">Part 3 prerequisites</span></a>. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Get <a href="https://docs.docker.com/machine/overview/"><span style=" text-decoration: underline; color:#0000ff;">Docker Machine</span></a> as described in <a href="https://docs.docker.com/get-started/part4/#prerequisites"><span style=" text-decoration: underline; color:#0000ff;">Part 4 prerequisites</span></a>. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Read the orientation in <a href="https://docs.docker.com/get-started/"><span style=" text-decoration: underline; color:#0000ff;">Part 1</span></a>. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Learn how to create containers in <a href="https://docs.docker.com/get-started/part2/"><span style=" text-decoration: underline; color:#0000ff;">Part 2</span></a>. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Make sure you have published the <span style=" font-family:'Courier New,courier';">friendlyhello</span> image you created by <a href="https://docs.docker.com/get-started/part2/#share-your-image"><span style=" text-decoration: underline; color:#0000ff;">pushing it to a registry</span></a>. We’ll use that shared image here. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Be sure your image works as a deployed container. Run this command, slotting in your info for <span style=" font-family:'Courier New,courier';">username</span>, <span style=" font-family:'Courier New,courier';">repo</span>, and <span style=" font-family:'Courier New,courier';">tag</span>: <span style=" font-family:'Courier New,courier';">docker run -p 80:80 username/repo:tag</span>, then visit <span style=" font-family:'Courier New,courier';">http://localhost/</span>. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Have a copy of your <span style=" font-family:'Courier New,courier';">docker-compose.yml</span> from <a href="https://docs.docker.com/get-started/part3/"><span style=" text-decoration: underline; color:#0000ff;">Part 3</span></a> handy. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Make sure that the machines you set up in <a href="https://docs.docker.com/get-started/part4/"><span style=" text-decoration: underline; color:#0000ff;">part 4</span></a> are running and ready. Run <span style=" font-family:'Courier New,courier';">docker-machine ls</span> to verify this. If the machines are stopped, run <span style=" font-family:'Courier New,courier';">docker-machine start myvm1</span> to boot the manager, followed by <span style=" font-family:'Courier New,courier';">docker-machine start myvm2</span> to boot the worker. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Have the swarm you created in <a href="https://docs.docker.com/get-started/part4/"><span style=" text-decoration: underline; color:#0000ff;">part 4</span></a> running and ready. Run <span style=" font-family:'Courier New,courier';">docker-machine ssh myvm1 &quot;docker node ls&quot;</span> to verify this. If the swarm is up, both nodes will report a <span style=" font-family:'Courier New,courier';">ready</span> status. If not, reinitialze the swarm and join the worker as described in <a href="https://docs.docker.com/get-started/part4/#set-up-your-swarm"><span style=" text-decoration: underline; color:#0000ff;">Set up your swarm</span></a>. </li></ul>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="introduction"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">I</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">ntroduction</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">In </span><a href="https://docs.docker.com/get-started/part4/"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">part 4</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">, you learned how to set up a swarm, which is a cluster of machines running Docker, and deployed an application to it, with containers running in concert on multiple machines. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Here in part 5, you’ll reach the top of the hierarchy of distributed applications: the </span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">stack</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. A stack is a group of interrelated services that share dependencies, and can be orchestrated and scaled together. A single stack is capable of defining and coordinating the functionality of an entire application (though very complex applications may want to use multiple stacks). </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Some good news is, you have technically been working with stacks since part 3, when you created a Compose file and used </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker stack deploy</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. But that was a single service stack running on a single host, which is not usually what takes place in production. Here, you will take what you’ve learned, make multiple services relate to each other, and run them on multiple machines. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">You’re doing great, this is the home stretch! </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="add-a-new-service-and-redeploy"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">A</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">dd a new service and redeploy</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">It’s easy to add services to our </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-compose.yml</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> file. First, let’s add a free visualizer service that lets us look at how our swarm is scheduling containers. </span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Open up <span style=" font-family:'Courier New,courier';">docker-compose.yml</span> in an editor and replace its contents with the following. Be sure to replace <span style=" font-family:'Courier New,courier';">username/repo:tag</span> with your image details. </li>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">version: &quot;3&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">services:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  web:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    # replace username/repo:tag with your name and image details</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    image: username/repo:tag</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    deploy:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">      replicas: 5</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">      restart_policy:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">        condition: on-failure</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">      resources:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">        limits:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">          cpus: &quot;0.1&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">          memory: 50M</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    ports:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">      - &quot;80:80&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    networks:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">      - webnet</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  visualizer:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    image: dockersamples/visualizer:stable</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    ports:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">      - &quot;8080:8080&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    volumes:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">      - &quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    deploy:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">      placement:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">        constraints: [node.role == manager]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    networks:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">      - webnet</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">networks:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  webnet:</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">The only thing new here is the peer service to </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">web</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">, named </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">visualizer</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. You’ll see two new things here: a </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">volumes</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> key, giving the visualizer access to the host’s socket file for Docker, and a </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">placement</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> key, ensuring that this service only ever runs on a swarm manager – never a worker. That’s because this container, built from </span><a href="https://github.com/ManoMarks/docker-swarm-visualizer"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">an open source project created by Docker</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">, displays Docker services running on a swarm in a diagram. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">We’ll talk more about placement constraints and volumes in a moment. </span></p>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Make sure your shell is configured to talk to <span style=" font-family:'Courier New,courier';">myvm1</span> (full examples are <a href="https://docs.docker.com/get-started/part4/#configure-a-docker-machine-shell-to-the-swarm-manager"><span style=" text-decoration: underline; color:#0000ff;">here</span></a>). </li>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Run <span style=" font-family:'Courier New,courier';">docker-machine ls</span> to list machines and make sure you are connected to <span style=" font-family:'Courier New,courier';">myvm1</span>, as indicated by an asterisk next it. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">If needed, re-run <span style=" font-family:'Courier New,courier';">docker-machine env myvm1</span>, then run the given command to configure the shell. </li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:2; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">On </span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">Mac or Linux</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> the command is: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:2; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">eval $(docker-machine env myvm1)</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:2; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:2; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">On </span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">Windows</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> the command is: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:2; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">&amp; &quot;C:\Program Files\Docker\Docker\Resources\bin\docker-machine.exe&quot; env myvm1 | Invoke-Expression</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:2; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Re-run the <span style=" font-family:'Courier New,courier';">docker stack deploy</span> command on the manager, and whatever services need updating will be updated: </li>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">$ docker stack deploy -c docker-compose.yml getstartedlab</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">Updating service getstartedlab_web (id: angi1bf5e4to03qu9f93trnxm)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">Creating service getstartedlab_visualizer (id: l9mnwkeq2jiononb5ihz9u7a4)</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Take a look at the visualizer. </li></ol>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">You saw in the Compose file that </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">visualizer</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> runs on port 8080. Get the IP address of one of your nodes by running </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine ls</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. Go to either IP address at port 8080 and you will see the visualizer running: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><img src="image13279.png" /><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">The single copy of </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">visualizer</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> is running on the manager as you expect, and the 5 instances of </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">web</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> are spread out across the swarm. You can corroborate this visualization by running </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker stack ps &lt;stack&gt;</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker stack ps getstartedlab</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">The visualizer is a standalone service that can run in any app that includes it in the stack. It doesn’t depend on anything else. Now let’s create a service that </span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-style:italic;">does</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> have a dependency: the Redis service that will provide a visitor counter. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="persist-the-data"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">P</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">ersist the data</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Let’s go through the same workflow once more to add a Redis database for storing app data. </span></p>
<ol style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Save this new <span style=" font-family:'Courier New,courier';">docker-compose.yml</span> file, which finally adds a Redis service. Be sure to replace <span style=" font-family:'Courier New,courier';">username/repo:tag</span> with your image details. </li>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">version: &quot;3&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">services:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  web:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    # replace username/repo:tag with your name and image details</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    image: username/repo:tag</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    deploy:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">      replicas: 5</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">      restart_policy:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">        condition: on-failure</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">      resources:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">        limits:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">          cpus: &quot;0.1&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">          memory: 50M</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    ports:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">      - &quot;80:80&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    networks:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">      - webnet</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  visualizer:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    image: dockersamples/visualizer:stable</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    ports:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">      - &quot;8080:8080&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    volumes:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">      - &quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    deploy:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">      placement:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">        constraints: [node.role == manager]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    networks:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">      - webnet</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  redis:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    image: redis</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    ports:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">      - &quot;6379:6379&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    volumes:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">      - &quot;/home/docker/data:/data&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    deploy:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">      placement:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">        constraints: [node.role == manager]</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    command: redis-server --appendonly yes</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">    networks:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">      - webnet</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">networks:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  webnet:</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Redis has an official image in the Docker library and has been granted the short </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">image</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> name of just </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">redis</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">, so no </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">username/repo</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> notation here. The Redis port, 6379, has been pre-configured by Redis to be exposed from the container to the host, and here in our Compose file we expose it from the host to the world, so you can actually enter the IP for any of your nodes into Redis Desktop Manager and manage this Redis instance, if you so choose. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Most importantly, there are a couple of things in the </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">redis</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> specification that make data persist between deployments of this stack: </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">redis</span> always runs on the manager, so it’s always using the same filesystem. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier';">redis</span> accesses an arbitrary directory in the host’s file system as <span style=" font-family:'Courier New,courier';">/data</span> inside the container, which is where Redis stores data. </li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Together, this is creating a “source of truth” in your host’s physical filesystem for the Redis data. Without this, Redis would store its data in </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">/data</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> inside the container’s filesystem, which would get wiped out if that container were ever redeployed. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">This source of truth has two components: </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">The placement constraint you put on the Redis service, ensuring that it always uses the same host. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">The volume you created that lets the container access <span style=" font-family:'Courier New,courier';">./data</span> (on the host) as <span style=" font-family:'Courier New,courier';">/data</span> (inside the Redis container). While containers come and go, the files stored on <span style=" font-family:'Courier New,courier';">./data</span> on the specified host will persist, enabling continuity. </li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">You are ready to deploy your new Redis-using stack. </span></p>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Create a <span style=" font-family:'Courier New,courier';">./data</span> directory on the manager: </li>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine ssh myvm1 &quot;mkdir ./data&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Make sure your shell is configured to talk to <span style=" font-family:'Courier New,courier';">myvm1</span> (full examples are <a href="https://docs.docker.com/get-started/part4/#configure-a-docker-machine-shell-to-the-swarm-manager"><span style=" text-decoration: underline; color:#0000ff;">here</span></a>). </li>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Run <span style=" font-family:'Courier New,courier';">docker-machine ls</span> to list machines and make sure you are connected to <span style=" font-family:'Courier New,courier';">myvm1</span>, as indicated by an asterisk next it. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">If needed, re-run <span style=" font-family:'Courier New,courier';">docker-machine env myvm1</span>, then run the given command to configure the shell. </li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:2; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">On </span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">Mac or Linux</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> the command is: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:2; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">eval $(docker-machine env myvm1)</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:2; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:2; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">On </span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">Windows</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> the command is: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:2; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">&amp; &quot;C:\Program Files\Docker\Docker\Resources\bin\docker-machine.exe&quot; env myvm1 | Invoke-Expression</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:2; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Run <span style=" font-family:'Courier New,courier';">docker stack deploy</span> one more time. </li>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">$ docker stack deploy -c docker-compose.yml getstartedlab</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Run <span style=" font-family:'Courier New,courier';">docker service ls</span> to verify that the three services are running as expected. </li>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">$ docker service ls</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">ID                  NAME                       MODE                REPLICAS            IMAGE                             PORTS</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">x7uij6xb4foj        getstartedlab_redis        replicated          1/1                 redis:latest                      *:6379-&gt;6379/tcp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">n5rvhm52ykq7        getstartedlab_visualizer   replicated          1/1                 dockersamples/visualizer:stable   *:8080-&gt;8080/tcp</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">mifd433bti1d        getstartedlab_web          replicated          5/5                 orangesnap/getstarted:latest    *:80-&gt;80/tcp</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px; font-family:'Courier New,courier'; font-size:8.25pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Check the web page at one of your nodes (e.g. <span style=" font-family:'Courier New,courier';">http://192.168.99.101</span>) and you’ll see the results of the visitor counter, which is now live and storing information on Redis. </li></ol>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><img src="image22076.png" /><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Also, check the visualizer at port 8080 on either node’s IP address, and you’ll see the </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">redis</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> service running along with the </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">web</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> and </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">visualizer</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> services. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:1; text-indent:0px;"><img src="image10507.png" /><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://docs.docker.com/get-started/part6/"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">On to Part 6 »</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="recap-optional"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">R</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">ecap (optional)</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Here’s </span><a href="https://asciinema.org/a/113840"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">a terminal recording of what was covered on this page</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="asciicast-container-113840"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Y</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">ou learned that stacks are inter-related services all running in concert, and that – surprise! – you’ve been using stacks since part three of this tutorial. You learned that to add more services to your stack, you insert them in your Compose file. Finally, you learned that by using a combination of placement constraints and volumes you can create a permanent home for persisting data, so that your app’s data survives when the container is torn down and redeployed. </span><a href="https://docs.docker.com/glossary/?term=stack"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">stack</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">, </span><a href="https://docs.docker.com/glossary/?term=data"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">data</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">, </span><a href="https://docs.docker.com/glossary/?term=persist"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">persist</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">, </span><a href="https://docs.docker.com/glossary/?term=dependencies"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">dependencies</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">, </span><a href="https://docs.docker.com/glossary/?term=redis"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">redis</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">, </span><a href="https://docs.docker.com/glossary/?term=storage"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">storage</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">, </span><a href="https://docs.docker.com/glossary/?term=volume"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">volume</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">, </span><a href="https://docs.docker.com/glossary/?term=port"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">port</span></a></p></body></html>