<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Когда вы пытаетесь использовать утилиту apt для установки программного обеспечения или обновления системы в Ubuntu, Debian, и других дистрибутивах вы можете столкнуться с ошибкой: Unable to lock the administration directory /var/lib/dpkg.</span></p>
<p align="center" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Эта ошибка по своей сути очень проста и исправить ее не сложно, но для новых пользователей она может стать серьезным препятствием на пути к освоению Linux систем. В этой статье мы рассмотрим что означает Unable to lock the administration directory /var/lib/dpkg, а также как решить эту проблему.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="ez-toc-container"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">С</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">одержание статьи:</span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://losst.ru/oshibka-unable-to-lock-the-administration-directory-var-lib-dpkg#106310901086_107910851072109510801090_110110901072_108610961080107310821072"><span style=" text-decoration: underline; color:#0000ff;">Что значит эта ошибка?</span></a></li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://losst.ru/oshibka-unable-to-lock-the-administration-directory-var-lib-dpkg#105010721082_108010891087108810721074108010901100nbspUnable_to_lock_the_administration_directory"><span style=" text-decoration: underline; color:#0000ff;">Как исправить Unable to lock the administration directory?</span></a></li>
<ul type="circle" style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 2;"><li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://losst.ru/oshibka-unable-to-lock-the-administration-directory-var-lib-dpkg#1_1047107210741077108810961077108510801077_108710881086107510881072108410841099_apt"><span style=" text-decoration: underline; color:#0000ff;">1. Завершение программы apt</span></a></li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://losst.ru/oshibka-unable-to-lock-the-administration-directory-var-lib-dpkg#2_1059107610721083108010901100_1092107210811083_1073108310861082108010881086107410821080"><span style=" text-decoration: underline; color:#0000ff;">2. Удалить файл блокировки</span></a></li></ul>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://losst.ru/oshibka-unable-to-lock-the-administration-directory-var-lib-dpkg#104210991074108610761099"><span style=" text-decoration: underline; color:#0000ff;">Выводы</span></a></li></ul>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="106310901086_107910851072109510801090_110110901072_108610961080107310821072"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">Ч</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">то значит эта ошибка?</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">В Ubuntu 16.10 строки с сообщением об ошибке будут выглядеть вот так:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">sudo apt install neofetch</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">[sudo] password for sergiy:<br />E: Could not get lock /var/lib/dpkg/lock - open (11: Resource temporarily unavailable)<br />E: Unable to lock the administration directory (/var/lib/dpkg), is another process using it?</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Вывод команды может быть немного другим, но сути ошибки это не меняет:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">E: Could not get lock /var/lib/apt/lists/lock - open (11: Resource temporarily unavailable)<br />E: Unable to lock directory /var/lib/apt/lists/<br />E: Could not get lock /var/lib/dpkg/lock - open (11: Resource temporarily unavailable)<br />E: Unable to lock the administration directory (/var/lib/dpkg/), is another process using it?</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Если перевести значение ошибки дословно, то утилита нам сообщает что не может создать файл блокировки /var/lib/apt/lists/lock или /var/lib/dpkg/lock, а поэтому не может быть уверена что она одна использует папку /var/lib/dpkg. Затем утилита спрашивает нет ли у нас уже запущенного второго экземпляра этой программы, который уже создал этот файл и сейчас работает с папкой. Дальше мы рассмотрим несколько способов решения этой проблемы. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="105010721082_108010891087108810721074108010901100nbspUnable_to_lock_the_administration_directory"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">К</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">ак исправить Unable to lock the administration directory?</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Утилита говорит, что запущен еще один экземпляр программы, значит самый простой способ все исправить — это подождать пока другая программа завершит работу и освободит папку.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Но это только если действительно запущена другая версия программы. Посмотрите список процессов и проверьте есть ли там уже запущенный процесс apt или apt-get. Для этого можно использовать ps:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">ps -A | grep apt</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image13872.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Вы также можете посмотреть какой процесс сейчас использует этот файл с помощью команды:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">sudo fuser -cuk /var/lib/dpkg/lock</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="1_1047107210741077108810961077108510801077_108710881086107510881072108410841099_apt"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">1</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">. Завершение программы apt</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Вы можете подождать пока завершится программа, или завершить ее вручную по PID номеру процесса с помощью утилиты kill. Если вы уверенны, что другая утилита не выполняет ничего важного или то что вы собираетесь установить важнее, то можно ее завершить. Например, используйте такую команду:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">sudo kill -9 PID</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Или:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">sudo kill -SIGKILL PID</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Например, если PID процесса apt будет 13433, то команда будет выглядеть вот так:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">sudo kill -9 13433<br />$ sudo kill -SIGKILL 13433</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Также вы можете уничтожить все процессы apt за раз с помощью комады:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">killall apt</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="2_1059107610721083108010901100_1092107210811083_1073108310861082108010881086107410821080"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">2</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">. Удалить файл блокировки</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Если в папке есть файл lock, то утилита не будет трогать другие файлы в этой папке, таким образом, создавая файл, программа говорит, что работает с этими данными и если еще кто-то попытается их менять то это вызовет повреждение. Такой концепт используется не только в Linux, но и в Windows и других операционных системах.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Когда запускается утилита apt создается файл блокировки в таких директориях: /var/lib/apt/lists/, /var/lib/dpkg/ и /var/cache/apt/archives/. Это помогает утилите обнаружить уже запущенную копию и не повредить свои данные. Когда утилита завершает работу, данные удаляются.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Но файл блокировки может остаться в одной из директорий даже после завершения программы, если утилита завершила работу неправильно, например, с ошибкой сегментации или было неожиданное отключение электричества. В таком случае вам будет достаточно удалить эти файлы чтобы исправить ошибку. Сначала удалите файл блокировки из /var/lib/dpkg:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">sudo rm /var/lib/dpkg/lock</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Теперь запустите процесс перенастройки dpkg:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">sudo dpkg --configure -a</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Или же можно вручную удалить оставшиеся файлы блокировок:</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">sudo rm /var/lib/apt/lists/lock<br />$ sudo rm /var/cache/apt/archives/lock</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Только после этого можно выполнить обновление системы или установку программного обеспечения, больше ошибки нет будет. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="104210991074108610761099"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">В</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">ыводы</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Мы рассмотрели два способа решения ошибки unable to lock the administration directory var lib dpkg которая может вызвать затруднения у новых пользователей. Но теперь вы знаете почему она появляется и как с ней бороться. Если у вас остались вопросы, пишите в комментариях!</span></p></body></html>