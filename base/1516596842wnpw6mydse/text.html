<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="prerequisites"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">P</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">rerequisites</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://docs.docker.com/engine/installation/"><span style=" text-decoration: underline; color:#0000ff;">Install Docker version 1.13 or higher</span></a>. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Get <a href="https://docs.docker.com/compose/overview/"><span style=" text-decoration: underline; color:#0000ff;">Docker Compose</span></a> as described in <a href="https://docs.docker.com/get-started/part3/#prerequisites"><span style=" text-decoration: underline; color:#0000ff;">Part 3 prerequisites</span></a>. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Get <a href="https://docs.docker.com/machine/overview/"><span style=" text-decoration: underline; color:#0000ff;">Docker Machine</span></a>, which is pre-installed with <a href="https://docs.docker.com/docker-for-mac/"><span style=" text-decoration: underline; color:#0000ff;">Docker for Mac</span></a> and <a href="https://docs.docker.com/docker-for-windows/"><span style=" text-decoration: underline; color:#0000ff;">Docker for Windows</span></a>, but on Linux systems you need to <a href="https://docs.docker.com/machine/install-machine/#installing-machine-directly"><span style=" text-decoration: underline; color:#0000ff;">install it directly</span></a>. On pre Windows 10 systems <span style=" font-style:italic;">without Hyper-V</span>, as well as Windows 10 Home, use <a href="https://docs.docker.com/toolbox/overview/"><span style=" text-decoration: underline; color:#0000ff;">Docker Toolbox</span></a>. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Read the orientation in <a href="https://docs.docker.com/get-started/"><span style=" text-decoration: underline; color:#0000ff;">Part 1</span></a>. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Learn how to create containers in <a href="https://docs.docker.com/get-started/part2/"><span style=" text-decoration: underline; color:#0000ff;">Part 2</span></a>. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Make sure you have published the <span style=" font-family:'Courier New,courier';">friendlyhello</span> image you created by <a href="https://docs.docker.com/get-started/part2/#share-your-image"><span style=" text-decoration: underline; color:#0000ff;">pushing it to a registry</span></a>. We’ll be using that shared image here. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Be sure your image works as a deployed container. Run this command, slotting in your info for <span style=" font-family:'Courier New,courier';">username</span>, <span style=" font-family:'Courier New,courier';">repo</span>, and <span style=" font-family:'Courier New,courier';">tag</span>: <span style=" font-family:'Courier New,courier';">docker run -p 80:80 username/repo:tag</span>, then visit <span style=" font-family:'Courier New,courier';">http://localhost/</span>. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;">Have a copy of your <span style=" font-family:'Courier New,courier';">docker-compose.yml</span> from <a href="https://docs.docker.com/get-started/part3/"><span style=" text-decoration: underline; color:#0000ff;">Part 3</span></a> handy. </li></ul>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="introduction"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">I</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">ntroduction</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">In </span><a href="https://docs.docker.com/get-started/part3/"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">part 3</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">, you took an app you wrote in </span><a href="https://docs.docker.com/get-started/part2/"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">part 2</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">, and defined how it should run in production by turning it into a service, scaling it up 5x in the process. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Here in part 4, you deploy this application onto a cluster, running it on multiple machines. Multi-container, multi-machine applications are made possible by joining multiple machines into a “Dockerized” cluster called a </span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">swarm</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="understanding-swarm-clusters"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">U</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">nderstanding Swarm clusters</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">A swarm is a group of machines that are running Docker and joined into a cluster. After that has happened, you continue to run the Docker commands you’re used to, but now they are executed on a cluster by a </span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">swarm manager</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. The machines in a swarm can be physical or virtual. After joining a swarm, they are referred to as </span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">nodes</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Swarm managers can use several strategies to run containers, such as “emptiest node” – which fills the least utilized machines with containers. Or “global”, which ensures that each machine gets exactly one instance of the specified container. You instruct the swarm manager to use these strategies in the Compose file, just like the one you have already been using. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Swarm managers are the only machines in a swarm that can execute your commands, or authorize other machines to join the swarm as </span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">workers</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. Workers are just there to provide capacity and do not have the authority to tell any other machine what it can and cannot do. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Up until now, you have been using Docker in a single-host mode on your local machine. But Docker also can be switched into </span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">swarm mode</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">, and that’s what enables the use of swarms. Enabling swarm mode instantly makes the current machine a swarm manager. From then on, Docker will run the commands you execute on the swarm you’re managing, rather than just on the current machine. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="set-up-your-swarm"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">S</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">et up your swarm</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">A swarm is made up of multiple nodes, which can be either physical or virtual machines. The basic concept is simple enough: run </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker swarm init</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> to enable swarm mode and make your current machine a swarm manager, then run </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker swarm join</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> on other machines to have them join the swarm as workers. Choose a tab below to see how this plays out in various contexts. We’ll use VMs to quickly create a two-machine cluster and turn it into a swarm. </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="create-a-cluster"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">C</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">reate a cluster</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://docs.docker.com/get-started/part4/#local"><span style=" text-decoration: underline; color:#0000ff;">Local VMs (Mac, Linux, Windows 7 and 8)</span></a> </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://docs.docker.com/get-started/part4/#localwin"><span style=" text-decoration: underline; color:#0000ff;">Local VMs (Windows 10/Hyper-V)</span></a></li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="local"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">V</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">Ms on your local machine (Mac, Linux, Windows 7 and 8)</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">First, you’ll need a hypervisor that can create virtual machines (VMs), so </span><a href="https://www.virtualbox.org/wiki/Downloads"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">install Oracle VirtualBox</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> for your machine’s OS. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">Note</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">: If you are on a Windows system that has Hyper-V installed, such as Windows 10, there is no need to install VirtualBox and you should use Hyper-V instead. View the instructions for Hyper-V systems by clicking the Hyper-V tab above. If you are using </span><a href="https://docs.docker.com/toolbox/overview/"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">Docker Toolbox</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">, you should already have VirtualBox installed as part of it, so you are good to go. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Now, create a couple of VMs using </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">, using the VirtualBox driver: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine create --driver virtualbox myvm1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine create --driver virtualbox myvm2</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<hr />
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="list-the-vms-and-get-their-ip-addresses"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">L</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">ist the VMs and get their IP addresses</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">You now have two VMs created, named </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">myvm1</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> and </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">myvm2</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Use this command to list the machines and get their IP addresses. </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine ls</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Here is example output from this command. </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">$ docker-machine ls</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">NAME    ACTIVE   DRIVER       STATE     URL                         SWARM   DOCKER        ERRORS</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">myvm1   -        virtualbox   Running   tcp://192.168.99.100:2376           v17.06.2-ce   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">myvm2   -        virtualbox   Running   tcp://192.168.99.101:2376           v17.06.2-ce   </span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="initialize-the-swarm-and-add-nodes"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">I</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">nitialize the swarm and add nodes</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">The first machine will act as the manager, which executes management commands and authenticates workers to join the swarm, and the second will be a worker. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">You can send commands to your VMs using </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine ssh</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. Instruct </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">myvm1</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> to become a swarm manager with </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker swarm init</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> and you’ll see output like this: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">$ docker-machine ssh myvm1 &quot;docker swarm init --advertise-addr &lt;myvm1 ip&gt;&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">Swarm initialized: current node &lt;node ID&gt; is now a manager.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:8.25pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">To add a worker to this swarm, run the following command:</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:8.25pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  docker swarm join \</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  --token &lt;token&gt; \</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">  &lt;myvm ip&gt;:&lt;port&gt;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:8.25pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">To add a manager to this swarm, run 'docker swarm join-token manager' and follow the instructions.</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Ports 2377 and 2376 </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Always run </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker swarm init</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> and </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker swarm join</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> with port 2377 (the swarm management port), or no port at all and let it take the default. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">The machine IP addresses returned by </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine ls</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> include port 2376, which is the Docker daemon port. Do not use this port or </span><a href="https://forums.docker.com/t/docker-swarm-join-with-virtualbox-connection-error-13-bad-certificate/31392/2"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">you may experience errors</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Having trouble using SSH? Try the –native-ssh flag </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Docker Machine has </span><a href="https://docs.docker.com/machine/reference/ssh/#different-types-of-ssh"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">the option to let you use your own system’s SSH</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">, if for some reason you’re having trouble sending commands to your Swarm manager. Just specify the </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">--native-ssh</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> flag when invoking the </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">ssh</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> command: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine --native-ssh ssh myvm1 ...</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">As you can see, the response to </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker swarm init</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> contains a pre-configured </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker swarm join</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> command for you to run on any nodes you want to add. Copy this command, and send it to </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">myvm2</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> via </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine ssh</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> to have </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">myvm2</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> join your new swarm as a worker: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">$ docker-machine ssh myvm2 &quot;docker swarm join \</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">--token &lt;token&gt; \</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">&lt;ip&gt;:2377&quot;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:8.25pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">This node joined a swarm as a worker.</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Congratulations, you have created your first swarm! </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Run </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker node ls</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> on the manager to view the nodes in this swarm: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">$ docker-machine ssh myvm1 &quot;docker node ls&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">ID                            HOSTNAME            STATUS              AVAILABILITY        MANAGER STATUS</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">brtu9urxwfd5j0zrmkubhpkbd     myvm2               Ready               Active</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">rihwohkh3ph38fhillhhb84sk *   myvm1               Ready               Active              Leader</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Leaving a swarm </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">If you want to start over, you can run </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker swarm leave</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> from each node. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="deploy-your-app-on-the-swarm-cluster"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">D</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">eploy your app on the swarm cluster</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">The hard part is over. Now you just repeat the process you used in </span><a href="https://docs.docker.com/get-started/part3/"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">part 3</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> to deploy on your new swarm. Just remember that only swarm managers like </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">myvm1</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> execute Docker commands; workers are just for capacity. </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="configure-a-docker-machine-shell-to-the-swarm-manager"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">C</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">onfigure a </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt; font-weight:600;">docker-machine</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;"> shell to the swarm manager</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">So far, you’ve been wrapping Docker commands in </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine ssh</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> to talk to the VMs. Another option is to run </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine env &lt;machine&gt;</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> to get and run a command that configures your current shell to talk to the Docker daemon on the VM. This method works better for the next step because it allows you to use your local </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-compose.yml</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> file to deploy the app “remotely” without having to copy it anywhere. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Type </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine env myvm1</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">, then copy-paste and run the command provided as the last line of the output to configure your shell to talk to </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">myvm1</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">, the swarm manager. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">The commands to configure your shell differ depending on whether you are Mac, Linux, or Windows, so examples of each are shown on the tabs below. </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://docs.docker.com/get-started/part4/#mac-linux-machine"><span style=" text-decoration: underline; color:#0000ff;">Mac, Linux</span></a> </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://docs.docker.com/get-started/part4/#win-machine"><span style=" text-decoration: underline; color:#0000ff;">Windows</span></a></li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="mac-linux-machine"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">D</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">ocker machine shell environment on Mac or Linux</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Run </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine env myvm1</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> to get the command to configure your shell to talk to </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">myvm1</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">$ docker-machine env myvm1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">export DOCKER_TLS_VERIFY=&quot;1&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">export DOCKER_HOST=&quot;tcp://192.168.99.100:2376&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">export DOCKER_CERT_PATH=&quot;/Users/sam/.docker/machine/machines/myvm1&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">export DOCKER_MACHINE_NAME=&quot;myvm1&quot;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"># Run this command to configure your shell:</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"># eval $(docker-machine env myvm1)</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Run the given command to configure your shell to talk to </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">myvm1</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">eval $(docker-machine env myvm1)</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Run </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine ls</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> to verify that </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">myvm1</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> is now the active machine, as indicated by the asterisk next to it. </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">$ docker-machine ls</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">NAME    ACTIVE   DRIVER       STATE     URL                         SWARM   DOCKER        ERRORS</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">myvm1   *        virtualbox   Running   tcp://192.168.99.100:2376           v17.06.2-ce   </span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">myvm2   -        virtualbox   Running   tcp://192.168.99.101:2376           v17.06.2-ce   </span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<hr />
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="deploy-the-app-on-the-swarm-manager"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">D</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">eploy the app on the swarm manager</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Now that you have </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">myvm1</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">, you can use its powers as a swarm manager to deploy your app by using the same </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker stack deploy</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> command you used in part 3 to </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">myvm1</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">, and your local copy of </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-compose.yml.</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">You are connected to </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">myvm1</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> by means of the </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> shell configuration, and you still have access to the files on your local host. Make sure you are in the same directory as before, which includes the </span><a href="https://docs.docker.com/get-started/part3/#docker-composeyml"><span style=" font-family:'Courier New,courier'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">docker-compose.yml</span></a><a href="https://docs.docker.com/get-started/part3/#docker-composeyml"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;"> file you created in part 3</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Just like before, run the following command to deploy the app on </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">myvm1</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker stack deploy -c docker-compose.yml getstartedlab</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">And that’s it, the app is deployed on a swarm cluster! </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Now you can use the same </span><a href="https://docs.docker.com/get-started/part3/#run-your-new-load-balanced-app"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">docker commands you used in part 3</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. Only this time you’ll see that the services (and associated containers) have been distributed between both </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">myvm1</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> and </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">myvm2</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">$ docker stack ps getstartedlab</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:8.25pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">ID            NAME                  IMAGE                   NODE   DESIRED STATE</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">jq2g3qp8nzwx  getstartedlab_web.1   john/get-started:part2  myvm1  Running</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">88wgshobzoxl  getstartedlab_web.2   john/get-started:part2  myvm2  Running</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">vbb1qbkb0o2z  getstartedlab_web.3   john/get-started:part2  myvm2  Running</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">ghii74p9budx  getstartedlab_web.4   john/get-started:part2  myvm1  Running</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">0prmarhavs87  getstartedlab_web.5   john/get-started:part2  myvm2  Running</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Connecting to VMs with </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine env</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> and </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine ssh</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;">To set your shell to talk to a different machine like <span style=" font-family:'Courier New,courier';">myvm2</span>, simply re-run <span style=" font-family:'Courier New,courier';">docker-machine env</span> in the same or a different shell, then run the given command to point to <span style=" font-family:'Courier New,courier';">myvm2</span>. This is always specific to the current shell. If you change to an unconfigured shell or open a new one, you need to re-run the commands. Use <span style=" font-family:'Courier New,courier';">docker-machine ls</span> to list machines, see what state they are in, get IP addresses, and find out which one, if any, you are connected to. To learn more, see the <a href="https://docs.docker.com/machine/get-started/#create-a-machine"><span style=" text-decoration: underline; color:#0000ff;">Docker Machine getting started topics</span></a>. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;">Alternatively, you can wrap Docker commands in the form of <span style=" font-family:'Courier New,courier';">docker-machine ssh &lt;machine&gt; &quot;&lt;command&gt;&quot;</span>, which logs directly into the VM but doesn’t give you immediate access to files on your local host. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;">On Mac and Linux, you can use <span style=" font-family:'Courier New,courier';">docker-machine scp &lt;file&gt; &lt;machine&gt;:~</span> to copy files across machines, but Windows users need a Linux terminal emulator like <a href="https://git-for-windows.github.io/"><span style=" text-decoration: underline; color:#0000ff;">Git Bash</span></a> in order for this to work. </li></ul>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">This tutorial demos both </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine ssh</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> and </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine env</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">, since these are available on all platforms via the </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> CLI. </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="accessing-your-cluster"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">A</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">ccessing your cluster</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">You can access your app from the IP address of </span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">either</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">myvm1</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> or </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">myvm2</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">The network you created is shared between them and load-balancing. Run </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine ls</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> to get your VMs’ IP addresses and visit either of them on a browser, hitting refresh (or just </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">curl</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> them). </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image15170.png" /><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">You’ll see five possible container IDs all cycling by randomly, demonstrating the load-balancing. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">The reason both IP addresses work is that nodes in a swarm participate in an ingress </span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">routing mesh</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. This ensures that a service deployed at a certain port within your swarm always has that port reserved to itself, no matter what node is actually running the container. Here’s a diagram of how a routing mesh for a service called </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">my-web</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> published at port </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">8080</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> on a three-node swarm would look: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><img src="image29788.png" /><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Having connectivity trouble? </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Keep in mind that in order to use the ingress network in the swarm, you need to have the following ports open between the swarm nodes before you enable swarm mode: </span></p>
<ul style="margin-top: 0px; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; -qt-list-indent: 1;"><li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:12px; margin-bottom:0px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;">Port 7946 TCP/UDP for container network discovery. </li>
<li style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;" style=" margin-top:0px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;">Port 4789 UDP for the container ingress network. </li></ul>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="iterating-and-scaling-your-app"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">I</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">terating and scaling your app</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">From here you can do everything you learned about in parts 2 and 3. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Scale the app by changing the </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-compose.yml</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> file. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Change the app behavior by editing code, then rebuild, and push the new image. (To do this, follow the same steps you took earlier to </span><a href="https://docs.docker.com/get-started/part2/#build-the-app"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">build the app</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> and </span><a href="https://docs.docker.com/get-started/part2/#publish-the-image"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">publish the image</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">). </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">In either case, simply run </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker stack deploy</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> again to deploy these changes. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">You can join any machine, physical or virtual, to this swarm, using the same </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker swarm join</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> command you used on </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">myvm2</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">, and capacity will be added to your cluster. Just run </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker stack deploy</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> afterwards, and your app will take advantage of the new resources. </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="cleanup-and-reboot"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">C</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">leanup and reboot</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="stacks-and-swarms"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">S</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">tacks and swarms</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">You can tear down the stack with </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker stack rm</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. For example: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker stack rm getstartedlab</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Keep the swarm or remove it? </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:40px; margin-right:40px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">At some point later, you can remove this swarm if you want to with </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine ssh myvm2 &quot;docker swarm leave&quot;</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> on the worker and </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine ssh myvm1 &quot;docker swarm leave --force&quot;</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> on the manager, but </span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-style:italic;">you’ll need this swarm for part 5, so please keep it around for now</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="unsetting-docker-machine-shell-variable-settings"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">U</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">nsetting docker-machine shell variable settings</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">You can unset the </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> environment variables in your current shell with the following command: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">eval $(docker-machine env -u)</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">This disconnects the shell from </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> created virtual machines, and allows you to continue working in the same shell, now using native </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> commands (for example, on Docker for Mac or Docker for Windows). To learn more, see the </span><a href="https://docs.docker.com/machine/get-started/#unset-environment-variables-in-the-current-shell"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">Machine topic on unsetting environment variables</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. </span></p>
<p style=" margin-top:14px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="restarting-docker-machines"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">R</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">estarting Docker machines</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">If you shut down your local host, Docker machines will stop running. You can check the status of machines by running </span><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine ls</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">. </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">$ docker-machine ls</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">NAME    ACTIVE   DRIVER       STATE     URL   SWARM   DOCKER    ERRORS</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">myvm1   -        virtualbox   Stopped                 Unknown</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">myvm2   -        virtualbox   Stopped                 Unknown</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">To restart a machine that’s stopped, run: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine start &lt;machine-name&gt;</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">For example: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">$ docker-machine start myvm1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">Starting &quot;myvm1&quot;...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">(myvm1) Check network to re-create if needed...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">(myvm1) Waiting for an IP...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">Machine &quot;myvm1&quot; was started.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">Waiting for SSH to be available...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">Detecting the provisioner...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">Started machines may have new IP addresses. You may need to re-run the `docker-machine env` command.</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:8.25pt;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">$ docker-machine start myvm2</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">Starting &quot;myvm2&quot;...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">(myvm2) Check network to re-create if needed...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">(myvm2) Waiting for an IP...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">Machine &quot;myvm2&quot; was started.</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">Waiting for SSH to be available...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">Detecting the provisioner...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">Started machines may have new IP addresses. You may need to re-run the `docker-machine env` command.</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a href="https://docs.docker.com/get-started/part5/"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">On to Part 5 »</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:16px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="recap-and-cheat-sheet-optional"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">R</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; font-weight:600;">ecap and cheat sheet (optional)</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;"> </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Here’s </span><a href="https://asciinema.org/a/113837"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt; text-decoration: underline; color:#0000ff;">a terminal recording of what was covered on this page</span></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">: </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><a name="asciicast-container-113837"></a><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">I</span><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">n part 4 you learned what a swarm is, how nodes in swarms can be managers or workers, created a swarm, and deployed an application on it. You saw that the core Docker commands didn’t change from part 3, they just had to be targeted to run on a swarm master. You also saw the power of Docker’s networking in action, which kept load-balancing requests across containers, even though they were running on different machines. Finally, you learned how to iterate and scale your app on a cluster. </span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'MS Shell Dlg 2'; font-size:8.25pt;">Here are some commands you might like to run to interact with your swarm and your VMs a bit: </span></p>
<p style=" margin-top:12px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine create --driver virtualbox myvm1 # Create a VM (Mac, Win7, Linux)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine create -d hyperv --hyperv-virtual-switch &quot;myswitch&quot; myvm1 # Win10</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine env myvm1                # View basic information about your node</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine ssh myvm1 &quot;docker node ls&quot;         # List the nodes in your swarm</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine ssh myvm1 &quot;docker node inspect &lt;node ID&gt;&quot;        # Inspect a node</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine ssh myvm1 &quot;docker swarm join-token -q worker&quot;   # View join token</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine ssh myvm1   # Open an SSH session with the VM; type &quot;exit&quot; to end</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker node ls                # View nodes in swarm (while logged on to manager)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine ssh myvm2 &quot;docker swarm leave&quot;  # Make the worker leave the swarm</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine ssh myvm1 &quot;docker swarm leave -f&quot; # Make master leave, kill swarm</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine ls # list VMs, asterisk shows which VM this shell is talking to</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine start myvm1            # Start a VM that is currently not running</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine env myvm1      # show environment variables and command for myvm1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">eval $(docker-machine env myvm1)         # Mac command to connect shell to myvm1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">&amp; &quot;C:\Program Files\Docker\Docker\Resources\bin\docker-machine.exe&quot; env myvm1 | Invoke-Expression   # Windows command to connect shell to myvm1</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker stack deploy -c &lt;file&gt; &lt;app&gt;  # Deploy an app; command shell must be set to talk to manager (myvm1), uses local Compose file</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine scp docker-compose.yml myvm1:~ # Copy file to node's home dir (only required if you use ssh to connect to manager and deploy the app)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine ssh myvm1 &quot;docker stack deploy -c &lt;file&gt; &lt;app&gt;&quot;   # Deploy an app using ssh (you must have first copied the Compose file to myvm1)</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">eval $(docker-machine env -u)     # Disconnect shell from VMs, use native docker</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine stop $(docker-machine ls -q)               # Stop all running VMs</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;"><span style=" font-family:'Courier New,courier'; font-size:8.25pt;">docker-machine rm $(docker-machine ls -q) # Delete all VMs and their disk images</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; font-family:'Courier New,courier'; font-size:8.25pt;"><br /></p></body></html>