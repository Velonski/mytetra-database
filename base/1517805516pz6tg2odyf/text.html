<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">
<html><head><meta name="qrichtext" content="1" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><style type="text/css">
p, li { white-space: pre-wrap; }
</style></head><body style=" font-family:'DejaVu Sans'; font-size:11pt; font-weight:400; font-style:normal;">
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529; background-color:#ffffff;">TLS (он же Transport Layer Security) — протокол защиты веб-страниц, который заменил собой SSL. По сути TLS = SSL и является следующим поколением (версией) устаревшего и подверженного POODLE-атакам стандарта.</span><img src="image14690.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529; background-color:#ffffff;">TLS умеет не только шифровать данные, но также проводить аутентификацию пользователей на сервере и проверять информацию на целостность. Протокол обязателен к использованию коммерческими сайтами и организациями, которые хотят подтвердить свою подлинность. Ну и обеспечения конфиденциальности пользователей.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529; background-color:#ffffff;">Для установки безопасного канала используется протокол TLS Handshake, также нужно получить сертификат от ЦС и подгрузить криптобиблиотеку, OpenSSL в нашем случае.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529; background-color:#ffffff;">Для включения TLS и настройки HTTPS-сервера в Nginx нужно в файле конфигурации в секцию server включить параметр SSL:</span></p>
<p style=" margin-top:20px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">server {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">    listen              443 ssl;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">    server_name         example.com;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">    ssl_certificate     example.com.crt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">    ssl_certificate_key example.com.key;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">    ssl_protocols       TLSv1.1 TLSv1.2;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">    ssl_ciphers AES128-SHA:AES256-SHA:RC4-SHA:DES-CBC3-SHA:RC4-MD5;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">    ...</span></p>
<p style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">}</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#888888; background-color:#ffffff;"># включение SSL на 443 порте, указание сертификата, ключа, протоколов TLS и используемых шифров</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529; background-color:#ffffff;">Здесь директива</span><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529;"> </span><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; font-style:italic; color:#212529;">ssl_protocols</span><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529;"> ограничивает используемые протоколы, а </span><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; font-style:italic; color:#212529;">ssl_ciphers</span><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529;"> описывает разрешенные шифры в формате, поддерживаемом библиотекой OpenSSL. К примеру:</span></p>
<p style=" margin-top:20px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">ssl_ciphers ALL:!aNULL:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#888888; background-color:#ffffff;"># пример использования всех шифров в формате OpenSSL</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529; background-color:#ffffff;">Важно понимать, что операции TLS/SSL достаточно ресурсоемкие, так что даже требуется запуск нескольких рабочих процессов на мультипроцессорных системах. Самой “тяжелой” и в плане нагрузки, и по времени исполнения, является операция TLS Handshake. Поэтому лучшим решением будет оптимизация сессии: постоянные соединения, кэширование, статические ключи и включение OCSP Stapling.</span></p>
<p style=" margin-top:40px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:51px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#333333; background-color:#ffffff;">Keepalive</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529; background-color:#ffffff;">Использование постоянных соединений дает возможность в условиях одного подключения обрабатывать сразу несколько запросов.</span><img src="image26057.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529; background-color:#ffffff;">Для этого в секцию</span><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529;"> </span><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; font-style:italic; color:#212529;">server</span><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529;"> файла конфигурации нужно добавить:</span></p>
<p style=" margin-top:20px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">server {</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa; background-color:#212529;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">...</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">keepalive_timeout   70;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa; background-color:#212529;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">…</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa; background-color:#212529;"><br /></p>
<p style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">}</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#888888; background-color:#ffffff;"># включение keepalive</span></p>
<p style=" margin-top:40px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:51px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#333333; background-color:#ffffff;">Кэширование сессии</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529; background-color:#ffffff;">Кэширование необходимо для повторного использования ключей, чтобы не повторять хэндшейк.</span><img src="image23874.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529; background-color:#ffffff;">Для этого в секции</span><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529;"> </span><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; font-style:italic; color:#212529;">http</span><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529;"> файла конфигурации Nginx нужно добавить:</span></p>
<p style=" margin-top:20px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">http {</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">    ssl_session_cache   shared:SSL:100m;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">    ssl_session_timeout 1h;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">…</span></p>
<p style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">}</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#888888; background-color:#ffffff;"># включение общего кэша размером 100 МБ и таймаута времени сессии 1 час</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529; background-color:#ffffff;">В 1 МБ кэша помещается около 4000 сессий, так что представленный пример позволит хранить до 400 000 сессий.</span></p>
<p style=" margin-top:40px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:51px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#333333; background-color:#ffffff;">Session Tickets или мандат сессии</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529; background-color:#ffffff;">Протокол TLS умеет использовать</span><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529;"> </span><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; font-style:italic; color:#212529;">session tickets</span><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529;"> для возобновления сеанса, при условии, что клиент их поддерживает (браузеры семейства Chromium и Firefox). Для этого TLS-сервер отправляет клиенту состояние сессии (session ticket), шифруя его своим ключом, и идентификатор ключа. Клиент возобновляет защищенную сессию, отправляя последний тикет на сервер во время инициализации процедуры TLS Handshake. А сервер, в свою очередь, возобновляет сессию в соответствии с сохраненными параметрами.</span><img src="image21885.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529; background-color:#ffffff;">Реализуется все очень просто. В конфигурацию Nginx в уже знакомой секции</span><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529;"> </span><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; font-style:italic; color:#212529;">server</span><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529;"> необходимо добавить:</span></p>
<p style=" margin-top:20px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">server {</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa; background-color:#212529;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">…</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">ssl_session_ticket_key current.key;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">ssl_session_ticket_key prev.key;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">ssl_session_ticket_key prevprev.key;</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa; background-color:#212529;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">…</span></p>
<p style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">}</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#888888; background-color:#ffffff;"># включение статических ключей</span></p>
<p style=" margin-top:40px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:51px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#333333; background-color:#ffffff;">OCSP Stapling</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529; background-color:#ffffff;">Online Certificate Status Protocol — механизм проверки актуальности сертификата SSL, который заменил менее быстрый протокол CRL (Certificate Revocation List). При использовании CRL браузер загружает список аннулированных сертификатов и проверяет текущий сертификата, что увеличивает время подключения. Тогда как при использовании OCSP браузер отправляет проверочный запрос на адрес OCSP и в ответ получает статус сертификата, что может сильно нагружать сервера центров сертификации.</span><img src="image4806.png" /></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529; background-color:#ffffff;">Для использования протокола применяется OCSP Stapling — владелец сертификата самостоятельно с определенным интервалом опрашивает сервер OCSP и кэширует ответ, который содержит электронную подпись. Сам ответ “сшивается” с TLS Handshake через расширение запроса Certificate Status Request. Так что на серверы центров сертификации не поступает огромное количество запросов, которые также содержат информацию о просмотрах пользователя.</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529; background-color:#ffffff;">Чтобы включить OCSP Stapling, нужно добавить несколько строчек кода в файл конфигурации Nginx:</span></p>
<p style=" margin-top:20px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">server {</span></p>
<p style="-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa; background-color:#212529;"><br /></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">…</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">ssl_stapling on;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">ssl_stapling_verify on;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">ssl_trusted_certificate /etc/nginx/ssl/example.com.crtt;</span></p>
<p style=" margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">…</span></p>
<p style=" margin-top:0px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">}</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#888888; background-color:#ffffff;"># включение OCSP Stapling и подключение доверенного сертификата</span></p>
<p style=" margin-top:40px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:51px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#333333; background-color:#ffffff;">Дополнительные функции</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529; background-color:#ffffff;">Для принудительного использования браузером протокола HTTPS существует механизм под названием Strict Transport Security:</span></p>
<p style=" margin-top:20px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:18px; background-color:#212529;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#aaaaaa;">add_header Strict-Transport-Security &quot;max-age=31536000; includeSubDomains&quot;;</span></p>
<p style=" margin-top:0px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Monaco,Courier New,Courier,mono'; font-size:8.25pt; color:#888888; background-color:#ffffff;"># включение Strict-Transport-Security, возраст в секундах</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529; background-color:#ffffff;">При помощи вот такой функции браузер будет понимать, что нужно использовать протокол HTTPS даже переходя по ссылке HTTP. Это поможет предотвратить часть атак, особенно, если на сервере не установлен редирект с HTTP на HTTPS.</span></p>
<p style=" margin-top:40px; margin-bottom:20px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; line-height:60px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529; background-color:#ffffff;">Самое главное</span></p>
<p style=" margin-top:12px; margin-bottom:12px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; background-color:#ffffff;"><span style=" font-family:'Georgia,Cambria,Times New Roman,Times,serif'; font-size:8.25pt; color:#212529; background-color:#ffffff;">Оптимизация TLS не займет много времени, но поможет существенно ускорить работу протокола и подключения пользователей к защищенным сайтам. А внедрение OCSP Stapling и HSTS еще и повысит безопасность соединения.</span></p></body></html>